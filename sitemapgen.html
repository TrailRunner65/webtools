<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-093YBG598G"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-093YBG598G');
  </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sitemap.xml Generator</title>
    <meta name="description" content="Internal RunCalcs utility for generating and reviewing sitemap.xml data before publishing." />
    <meta name="robots" content="noindex,nofollow" />
    <link rel="canonical" href="https://runcalcs.com/sitemapgen.html" />
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }

        .input-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        input[type="url"] {
            flex: 1;
            min-width: 250px;
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="url"]:focus {
            outline: none;
            border-color: #667eea;
        }

        input[type="number"], select {
            padding: 15px 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 16px;
            transition: border-color 0.3s;
        }

        input[type="number"]:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }

        label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            color: #666;
        }

        button {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .info-box {
            background: #e3f2fd;
            border: 2px solid #2196f3;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            color: #1565c0;
            font-size: 14px;
        }

        .progress-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            display: none;
        }

        .progress-section.active {
            display: block;
        }

        .progress-text {
            text-align: center;
            margin-bottom: 15px;
            font-size: 1.1em;
            color: #333;
            font-weight: 600;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: #e0e0e0;
            border-radius: 6px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
        }

        .progress-stats {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 15px;
            font-size: 0.9em;
            color: #666;
        }

        .results-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .results-header h2 {
            color: #333;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .action-btn {
            padding: 10px 20px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: background 0.2s;
        }

        .action-btn:hover {
            background: #5568d3;
        }

        .action-btn.success {
            background: #28a745;
        }

        .action-btn.success:hover {
            background: #218838;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 10px;
            text-align: center;
        }

        .stat-card h3 {
            font-size: 2em;
            margin-bottom: 5px;
            color: #1e3c72;
        }

        .stat-card p {
            color: #666;
            font-weight: 500;
            font-size: 0.9em;
        }

        .preview-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .preview-section h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .preview-code {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
        }

        .url-list {
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
        }

        .url-item {
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            font-size: 0.9em;
            color: #333;
        }

        .url-item:last-child {
            border-bottom: none;
        }

        .url-item:hover {
            background: #f8f9fa;
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h1>üó∫Ô∏è Sitemap.xml Generator</h1>
        <p>Automatically crawl your website and generate a sitemap.xml file</p>
    </div>

    <div class="input-section">
        <div class="input-group">
            <input type="url" id="urlInput" placeholder="https://example.com" required>
            <button id="generateBtn" onclick="generateSitemap()">Generate Sitemap</button>
        </div>

        <div class="options-grid">
            <div>
                <label>
                    Max Pages:
                    <input type="number" id="maxPages" value="100" min="1" max="500">
                </label>
            </div>
            <div>
                <label>
                    Change Frequency:
                    <select id="changefreq">
                        <option value="always">Always</option>
                        <option value="hourly">Hourly</option>
                        <option value="daily">Daily</option>
                        <option value="weekly" selected>Weekly</option>
                        <option value="monthly">Monthly</option>
                        <option value="yearly">Yearly</option>
                        <option value="never">Never</option>
                    </select>
                </label>
            </div>
            <div>
                <label>
                    Priority:
                    <select id="priority">
                        <option value="1.0">1.0 (Highest)</option>
                        <option value="0.9">0.9</option>
                        <option value="0.8" selected>0.8</option>
                        <option value="0.7">0.7</option>
                        <option value="0.6">0.6</option>
                        <option value="0.5">0.5 (Medium)</option>
                        <option value="0.4">0.4</option>
                        <option value="0.3">0.3</option>
                        <option value="0.2">0.2</option>
                        <option value="0.1">0.1 (Lowest)</option>
                    </select>
                </label>
            </div>
        </div>

        <div class="info-box">
            <strong>‚ÑπÔ∏è How it works:</strong> Enter your website URL and the tool will crawl it to discover all internal pages. It will then generate a properly formatted sitemap.xml file that you can download and upload to your website's root directory.
        </div>
    </div>

    <div class="progress-section" id="progressSection">
        <div class="progress-text" id="progressText">Crawling website...</div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill"></div>
        </div>
        <div class="progress-stats">
            <span>Pages Found: <strong id="pagesFound">0</strong></span>
            <span>Pages Crawled: <strong id="pagesCrawled">0</strong></span>
        </div>
    </div>

    <div class="results-section" id="resultsSection">
        <div class="results-header">
            <h2>Sitemap Generated!</h2>
            <div class="action-buttons">
                <button class="action-btn success" onclick="downloadSitemap()">üì• Download sitemap.xml</button>
                <button class="action-btn" onclick="copySitemap()">üìã Copy to Clipboard</button>
                <button class="action-btn" onclick="resetForm()">üîÑ Generate Another</button>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3 id="totalUrls">0</h3>
                <p>Total URLs</p>
            </div>
            <div class="stat-card">
                <h3 id="fileSize">0 KB</h3>
                <p>File Size</p>
            </div>
        </div>

        <div class="preview-section">
            <h3>Sitemap Preview</h3>
            <div class="preview-code" id="sitemapPreview"></div>
        </div>

        <div class="preview-section">
            <h3>URLs Included</h3>
            <div class="url-list" id="urlList"></div>
        </div>
    </div>
</div>

<script>
    let sitemapXml = '';
    let discoveredUrls = [];
    const urlLastModified = new Map();

    async function generateSitemap() {
        const url = document.getElementById('urlInput').value.trim();
        const maxPages = parseInt(document.getElementById('maxPages').value) || 100;

        if (!url) {
            alert('Please enter a URL');
            return;
        }

        try {
            new URL(url);
        } catch {
            alert('Please enter a valid URL');
            return;
        }

        document.getElementById('generateBtn').disabled = true;
        document.getElementById('progressSection').classList.add('active');
        document.getElementById('resultsSection').classList.remove('active');

        discoveredUrls = [];
        urlLastModified.clear();
        await crawlWebsite(url, maxPages);

        if (discoveredUrls.length === 0) {
            alert('Could not access the website. The site may block automated access or require authentication.');
            document.getElementById('generateBtn').disabled = false;
            document.getElementById('progressSection').classList.remove('active');
            return;
        }

        generateXml();
        displayResults();

        document.getElementById('generateBtn').disabled = false;
        document.getElementById('progressSection').classList.remove('active');
        document.getElementById('resultsSection').classList.add('active');
    }

    async function crawlWebsite(startUrl, maxPages) {
        const baseUrl = new URL(startUrl);
        const visited = new Set();
        const queue = [startUrl];

        while (queue.length > 0 && visited.size < maxPages) {
            const currentUrl = queue.shift();

            if (visited.has(currentUrl)) continue;

            updateProgress(visited.size, maxPages, queue.length);

            visited.add(currentUrl);
            discoveredUrls.push(currentUrl);

            const pageData = await fetchPageLinks(currentUrl, baseUrl);
            if (pageData?.lastModified) {
                urlLastModified.set(currentUrl, pageData.lastModified);
            } else if (!urlLastModified.has(currentUrl)) {
                urlLastModified.set(currentUrl, new Date());
            }

            if (pageData?.links) {
                pageData.links.forEach(link => {
                    if (!visited.has(link) && !queue.includes(link)) {
                        queue.push(link);
                    }
                });
            }

            await new Promise(resolve => setTimeout(resolve, 200));
        }

        updateProgress(visited.size, maxPages, 0);
    }

    async function fetchPageLinks(url, baseUrl) {
        try {
            const response = await fetch(`https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`);
            if (!response.ok) return null;

            const html = await response.text();
            const lastModified = sanitizeLastModified(response.headers.get('last-modified'));
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const anchors = doc.querySelectorAll('a[href]');

            const internalLinks = new Set();

            anchors.forEach(link => {
                let href = link.getAttribute('href');

                if (!href || href.startsWith('#') || href.startsWith('javascript:') ||
                    href.startsWith('mailto:') || href.startsWith('tel:')) {
                    return;
                }

                try {
                    const linkUrl = new URL(href, url);

                    if (linkUrl.hostname === baseUrl.hostname) {
                        const normalized = normalizeUrl(linkUrl.href);
                        internalLinks.add(normalized);
                    }
                } catch (e) {
                    // Invalid URL
                }
            });

            return {
                links: Array.from(internalLinks),
                lastModified
            };
        } catch (error) {
            return null;
        }
    }

    function normalizeUrl(url) {
        const urlObj = new URL(url);
        let normalized = urlObj.origin + urlObj.pathname;
        if (normalized.endsWith('/') && normalized.length > urlObj.origin.length + 1) {
            normalized = normalized.slice(0, -1);
        }
        return normalized;
    }

    function updateProgress(crawled, max, queued) {
        const percent = Math.min((crawled / max) * 100, 100);
        document.getElementById('progressFill').style.width = percent + '%';
        document.getElementById('progressText').textContent =
            crawled >= max ? 'Finalizing sitemap...' : `Crawling website... (${queued} pages in queue)`;
        document.getElementById('pagesCrawled').textContent = crawled;
        document.getElementById('pagesFound').textContent = crawled + queued;
    }

    function generateXml() {
        const changefreq = document.getElementById('changefreq').value;
        const priority = document.getElementById('priority').value;

        let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
        xml += '<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n';

        discoveredUrls.forEach(url => {
            xml += '  <url>\n';
            xml += `    <loc>${escapeXml(url)}</loc>\n`;
            const lastmodDate = urlLastModified.get(url) || new Date();
            xml += `    <lastmod>${formatLastModified(lastmodDate)}</lastmod>\n`;
            xml += `    <changefreq>${changefreq}</changefreq>\n`;
            xml += `    <priority>${priority}</priority>\n`;
            xml += '  </url>\n';
        });

        xml += '</urlset>';

        sitemapXml = xml;
    }

    function escapeXml(unsafe) {
        return unsafe.replace(/[<>&'"]/g, (c) => {
            switch (c) {
                case '<': return '&lt;';
                case '>': return '&gt;';
                case '&': return '&amp;';
                case '\'': return '&apos;';
                case '"': return '&quot;';
            }
        });
    }

    function sanitizeLastModified(lastModifiedHeader) {
        const now = new Date();

        if (lastModifiedHeader) {
            const parsed = new Date(lastModifiedHeader);
            if (!isNaN(parsed.getTime())) {
                return parsed > now ? now : parsed;
            }
        }

        return now;
    }

    function formatLastModified(date) {
        const now = new Date();
        const safeDate = date instanceof Date && !isNaN(date) ? date : now;
        const clampedDate = safeDate > now ? now : safeDate;

        return clampedDate.toISOString().replace('Z', '+00:00');
    }

    function displayResults() {
        document.getElementById('totalUrls').textContent = discoveredUrls.length;

        const sizeInBytes = new Blob([sitemapXml]).size;
        const sizeInKB = (sizeInBytes / 1024).toFixed(2);
        document.getElementById('fileSize').textContent = sizeInKB + ' KB';

        const preview = document.getElementById('sitemapPreview');
        preview.textContent = sitemapXml.length > 5000
            ? sitemapXml.substring(0, 5000) + '\n\n... (truncated for display)'
            : sitemapXml;

        const urlList = document.getElementById('urlList');
        urlList.innerHTML = '';
        discoveredUrls.forEach(url => {
            const item = document.createElement('div');
            item.className = 'url-item';
            item.textContent = url;
            urlList.appendChild(item);
        });
    }

    function downloadSitemap() {
        const blob = new Blob([sitemapXml], { type: 'application/xml' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'sitemap.xml';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }

    function copySitemap() {
        navigator.clipboard.writeText(sitemapXml).then(() => {
            alert('Sitemap copied to clipboard!');
        }).catch(() => {
            alert('Failed to copy. Please try the download option instead.');
        });
    }

    function resetForm() {
        document.getElementById('urlInput').value = '';
        document.getElementById('resultsSection').classList.remove('active');
        sitemapXml = '';
        discoveredUrls = [];
        urlLastModified.clear();
    }

    document.getElementById('urlInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            generateSitemap();
        }
    });
</script>
</body>
</html>
